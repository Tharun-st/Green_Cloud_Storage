{% extends "base.html" %}

{% block title %}Dashboard - GreenCloud{% endblock %}

{% block content %}
<div class="dashboard">
    <div class="page-header">
        <h1><i class="fas fa-home"></i> Dashboard</h1>
        <p>Welcome back, {{ current_user.first_name or current_user.username }}!</p>
    </div>

    <!-- Energy Awareness Banner -->
    <div class="energy-banner {{ stats.system.energy_level }}">
        <div class="energy-indicator">
            {% if stats.system.energy_level == 'green' %}
            <i class="fas fa-leaf"></i>
            {% elif stats.system.energy_level == 'yellow' %}
            <i class="fas fa-exclamation-triangle"></i>
            {% else %}
            <i class="fas fa-bolt"></i>
            {% endif %}
        </div>
        <div class="energy-text">
            <strong>{{ stats.system.energy_message }}</strong>
            <span>Energy Score: {{ stats.energy_score }}/100</span>
        </div>
        {% if current_user.is_admin %}
        <a href="{{ url_for('system.monitor_dashboard') }}" class="btn btn-light btn-sm">View Details</a>
        {% endif %}
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon blue">
                <i class="fas fa-file"></i>
            </div>
            <div class="stat-info">
                <h3>{{ stats.total_files }}</h3>
                <p>Total Files</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon green">
                <i class="fas fa-folder"></i>
            </div>
            <div class="stat-info">
                <h3>{{ stats.total_folders }}</h3>
                <p>Folders</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon orange">
                <i class="fas fa-hdd"></i>
            </div>
            <div class="stat-info">
                <h3>{{ (stats.storage_used / (1024**3))|round(2) }} GB</h3>
                <p>Storage Used</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon purple">
                <i class="fas fa-leaf"></i>
            </div>
            <div class="stat-info">
                <h3>{{ stats.greenops_score }}/100</h3>
                <p>GreenOps Score</p>
            </div>
        </div>
    </div>

    <!-- System Resource Cards -->
    <div class="system-resources">
        <div class="resource-card">
            <div class="resource-header">
                <i class="fas fa-microchip"></i>
                <span>CPU</span>
            </div>
            <div class="resource-value">{{ stats.system.cpu.percent }}%</div>
            <div class="resource-bar">
                <div class="resource-fill {{ stats.system.cpu.status }}" data-width="{{ stats.system.cpu.percent }}">
                </div>
            </div>
        </div>

        <div class="resource-card">
            <div class="resource-header">
                <i class="fas fa-memory"></i>
                <span>Memory</span>
            </div>
            <div class="resource-value">{{ stats.system.memory.percent|round(1) }}%</div>
            <div class="resource-bar">
                <div class="resource-fill {{ stats.system.memory.status }}"
                    data-width="{{ stats.system.memory.percent }}"></div>
            </div>
        </div>

        <div class="resource-card">
            <div class="resource-header">
                <i class="fas fa-hdd"></i>
                <span>Disk</span>
            </div>
            <div class="resource-value">{{ stats.system.disk.percent|round(1) }}%</div>
            <div class="resource-bar">
                <div class="resource-fill {{ stats.system.disk.status }}" data-width="{{ stats.system.disk.percent }}">
                </div>
            </div>
        </div>

        <div class="resource-card">
            <div class="resource-header">
                <i class="fas fa-clock"></i>
                <span>Uptime</span>
            </div>
            <div class="resource-value-text">{{ stats.system.uptime.formatted }}</div>
        </div>
    </div>

    <!-- Storage Chart -->
    <div class="card">
        <div class="card-header">
            <h3><i class="fas fa-chart-pie"></i> Storage Usage</h3>
        </div>
        <div class="card-body">
            <div class="storage-chart">
                <div class="storage-bar-large">
                    <div class="storage-fill-large" data-width="{{ stats.storage_percentage }}">
                        {{ stats.storage_percentage|round(1) }}%
                    </div>
                </div>
                <div class="storage-details">
                    <span>{{ (stats.storage_used / (1024**3))|round(2) }} GB used</span>
                    <span>{{ ((stats.storage_quota - stats.storage_used) / (1024**3))|round(2) }} GB available</span>
                    <span>{{ (stats.storage_quota / (1024**3))|round(0) }} GB total</span>
                </div>
            </div>
        </div>
    </div>

    <div class="dashboard-grid">
        <!-- Recent Files -->
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-clock"></i> Recent Files</h3>
                <a href="{{ url_for('files.index') }}" class="btn-link">View All</a>
            </div>
            <div class="card-body">
                {% if stats.recent_files %}
                <div class="file-list">
                    {% for file in stats.recent_files %}
                    <div class="file-item">
                        <i class="fas {{ file.get_icon_class() }} file-icon"></i>
                        <div class="file-info">
                            <div class="file-name">{{ file.original_filename }}</div>
                            <div class="file-meta">{{ file.get_size_formatted() }} • {{ file.created_at.strftime('%b %d,
                                %Y') }} • By {{ file.owner.username }}</div>
                        </div>
                        <div class="file-actions-inline">
                            <a href="{{ url_for('files.preview', file_id=file.id) }}" class="btn-icon" title="Preview">
                                <i class="fas fa-eye"></i>
                            </a>
                            <a href="{{ url_for('files.download', file_id=file.id) }}" class="btn-icon" title="Download">
                                <i class="fas fa-download"></i>
                            </a>
                            <button class="btn-icon copy-link-btn"
                                data-url="{{ url_for('files.download', file_id=file.id, _external=True) }}"
                                title="Copy download link">
                                <i class="fas fa-link"></i>
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                    <i class="fas fa-file"></i>
                    <p>No files yet. Start by uploading your first file!</p>
                    <a href="{{ url_for('files.index') }}" class="btn btn-primary">Upload Files</a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- GreenOps Suggestions -->
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-leaf"></i> GreenOps Suggestions</h3>
                {% if current_user.is_admin %}
                <a href="{{ url_for('greenops.dashboard') }}" class="btn-link">Details</a>
                {% endif %}
            </div>
            <div class="card-body">
                {% if stats.suggestions %}
                <div class="suggestions-list">
                    {% for suggestion in stats.suggestions[:5] %}
                    <div class="suggestion-item">
                        <i class="fas fa-lightbulb"></i>
                        <span>{{ suggestion }}</span>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                    <i class="fas fa-check-circle"></i>
                    <p>Great! Your storage is well optimized.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <a href="{{ url_for('files.index') }}" class="action-btn">
            <i class="fas fa-upload"></i>
            <span>Upload Files</span>
        </a>
        <a href="{{ url_for('files.index') }}" class="action-btn">
            <i class="fas fa-folder-plus"></i>
            <span>Create Folder</span>
        </a>
        {% if current_user.is_admin %}
        <a href="{{ url_for('greenops.dashboard') }}" class="action-btn">
            <i class="fas fa-broom"></i>
            <span>Optimize Storage</span>
        </a>
        {% endif %}
        <a href="{{ url_for('files.favorites') }}" class="action-btn">
            <i class="fas fa-star"></i>
            <span>Favorites</span>
        </a>
    </div>
</div>
{% endblock %}